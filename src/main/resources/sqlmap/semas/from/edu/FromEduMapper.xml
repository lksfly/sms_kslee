<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 교육시스템 -->
<mapper namespace="kr.bizdata.semas.from.edu.mapper.FromEduMapper">
	
	<resultMap id="FromEduInfo" type="kr.bizdata.semas.from.edu.info.FromEduInfo" />
	
	<!-- 지급온라인 -->
	<select id="selectList_1" resultMap="FromEduInfo" fetchSize="1000">
		/* SQL ID : FromEduMapper.selectList_1 */
		SELECT C.BSNS_NM                                                      AS SPRT_BIZ_NM         /* 지원사업명 */
		     , B.PBLANC_YEAR                                                  AS SPRT_BIZ_YR         /* 지원사업연도 */
		     , '01'                                                           AS SRC_SYS_CD          /* 출처시스템코드 (하드코딩) */
		     , '01'                                                           AS SPRT_BIZ_DIV_CD     /* 지원사업구분코드 (하드코딩) */
             
		     , NULL                                                           AS SPRT_CNTR_CD        /* 지원센터코드 */
		     , '1'                                                            AS APLY_STS_CD         /* 신청상태코드 (하드코딩) */
		     , CASE WHEN LENGTH(REGEXP_REPLACE(A.BIZR_NO, '-', '')) = 10 THEN REGEXP_REPLACE(A.BIZR_NO, '-', '')
		            ELSE NULL END                                             AS BRNO                /* 사업자등록번호 (10자리가 아닌것도 있음) */
		     , A.BSNM_NM                                                      AS ENT_NM              /* 기업명 */
		     , NULL                                                           AS CRNO                /* 법인등록번호 */
		     , CASE WHEN A.BIZR_NO IS NULL OR LENGTH(REGEXP_REPLACE(A.BIZR_NO, '-', '')) != 10 THEN '9'
		            WHEN SUBSTR(REGEXP_REPLACE(A.BIZR_NO, '-', ''), 4, 2) IN ('81', '82', '83', '84', '85', '86', '87', '88') THEN '1'
		            ELSE '2' END                                              AS BZMN_TYPE_CD        /* 사업자유형코드 (1: 법인기업, 2: 개인기업, 9: 알수없음) */
		     , REGEXP_REPLACE(A.BSNM_ZIP, '[^[:digit:]]')                     AS ENT_ZIP             /* 기업우편번호 */
		     , A.BSNM_ADRES                                                   AS ENT_ADDR            /* 기업기본주소 */
		     , A.BSNM_DETAIL_ADRES                                            AS ENT_DADDR           /* 기업상세주소 */
		     , CASE WHEN LENGTH(REGEXP_REPLACE(A.FNTN_DT, '[^[:digit:]]')) = 8 THEN REGEXP_REPLACE(A.FNTN_DT, '[^[:digit:]]')
		            ELSE NULL END                                             AS FNDN_YMD            /* 설립일자 (-포함, 8자리가 아닌 데이터 존재) */
		     , NULL                                                           AS SLS_AMT             /* 매출액 */
		     , NULL                                                           AS FT_WRKR_CNT         /* 상시근로자수 */
		     , REGEXP_REPLACE(A.CLOSED_DT, '-', '')                           AS CLSBIZ_YMD          /* 폐업일자 (-만포함) */
		     , A.INDUTY_SE_CODE                                               AS KSIC_SRCH_CD        /* 표준산업분류 검색용 코드 (업종코드 또는 표준산업분류코드) (4자리만존재) */
		     , NULL                                                           AS ENT_TELNO           /* 기업전화번호 */
		     , D.DISCRHASH                                                    AS DI_VAL              /* DI값 */
		     , crypto_semas.DEC(D.MEMNM,'F@42')                               AS APLCNT_NM           /* 신청자명 (복호화) */
		     , E.PAY_AMT                                                      AS GIVE_AMT            /* 지급금액 */
		     , crypto_semas.DEC(D.EMAIL,'F@42')                               AS APLCNT_EML          /* 신청자이메일 (복호화) */
		     , crypto_semas.DEC(D.PHONE,'F@42')                               AS APLCNT_TELNO        /* 신청자전화번호 (복호화) */
		     , crypto_semas.DEC(D.MOBILE,'F@42')                              AS APLCNT_MBNO         /* 신청자핸드폰 (복호화) */
		     , REGEXP_REPLACE(D.ZIPCODE, '[^[:digit:]]')                      AS APLCNT_ZIP          /* 신청자우편번호 */
		     , crypto_semas.DEC(D.ADDR1,'F@42')                               AS APLCNT_ADDR         /* 신청자기본주소 (복호화) */
		     , crypto_semas.DEC(D.ADDR2,'F@42')                               AS APLCNT_DADDR        /* 신청자상세주소 (복호화) */
		     , REGEXP_REPLACE(crypto_semas.DEC(D.BIRTHDATE,'F@42'),'-','')    AS APLCNT_BRDT         /* 신청자생년월일 (복호화) */
		     , CASE WHEN D.GENDER = 'M' THEN '1'
		            WHEN D.GENDER = 'F' THEN '2'
		            ELSE '9' END                                              AS APLCNT_GNDR_CD      /* 신청자성별코드 */
		     , NULL                                                           AS CI_VAL              /* CI값 */
		     , crypto_semas.DEC(D.LOGINID,	'F@42')                           AS SRC_LGN_ID          /* 출처시스템로그인ID (복호화) */
		     , TO_CHAR(A.REQST_DT, 'YYYYMMDD')                                AS APLY_YMD            /* 신청일자 */
		     , REGEXP_REPLACE(E.PAY_DT, '-', '')                              AS GIVE_YMD            /* 지급일자 */
		     , NULL                                                           AS CEO_NM              /* 대표자명 */
		     , REGEXP_REPLACE(A.COMPL_DT, '-', '')                            AS FNSH_YMD            /* 수료일자 */
		     , A.REG_DT                                                       AS SRC_REG_DT          /* 출처시스템등록일시 */
		     , REGEXP_REPLACE(E.PAY_DT, '-', '')                              AS SLCTN_YMD           /* 선정일자 (지급일자) */
		     
		     /* 교육시스템 */
		     , C.BSNS_NO                                                      AS EDU_SPRT_BIZNO      /* 교육지원사업번호 */
		     , A.PROGRM_SN                                                    AS PRGRM_SN            /* 프로그램순번 */
		     , A.USERNO                                                       AS MBER_SN             /* 회원순번 */
		  FROM EDUMNG.SPT_PROGRM_MBER A  /* 프로그램 수강생 */
		       INNER JOIN EDUMNG.SPT_TASK_PROGRM B  /* 과제프로그램 */
		          ON A.PROGRM_SN = B.PROGRM_SN
		       INNER JOIN EDUMNG.SPT_BSNS_MASTR C  /* 사업기본 */
		          ON B.BSNS_NO = C.BSNS_NO
		       INNER JOIN SEDA.MEM_PUB_INFO_HIS D
		          ON A.USER_HIS = D.MEMHIS
		       INNER JOIN EDUMNG.SPT_PROGRM_MBER_EXCCLC E
		          ON A.PROGRM_SN = E.PROGRM_SN 
		         AND A.USERNO = E.USERNO 
		 WHERE REQST_CODE = 'C'  /* 승인코드 */
		   AND COMPL_AT = 'Y'  /* 수료여부 */
		   AND B.BSNS_NO IN (2, 7)  /* (전문기술교육, 튼튼창업) */
		   AND E.CONFM_CODE = 'Y'  /* 코드한번더 확인 */
		   AND E.PAY_DT BETWEEN TO_CHAR(#{param.startDt}, 'YYYY-MM-DD') AND TO_CHAR(#{param.endDt}, 'YYYY-MM-DD')  /* 배치쿼리일자 */
	</select>
	
	<!-- 온라인 -->
	<select id="selectList_2" resultMap="FromEduInfo" fetchSize="1000">
		/* SQL ID : FromEduMapper.selectList_2 */
		SELECT C.BSNS_NM                                                      AS SPRT_BIZ_NM         /* 지원사업명 */
		     , B.PBLANC_YEAR                                                  AS SPRT_BIZ_YR         /* 지원사업연도 */
		     , '01'                                                           AS SRC_SYS_CD          /* 출처시스템코드 (하드코딩) */
		     , '01'                                                           AS SPRT_BIZ_DIV_CD     /* 지원사업구분코드 (하드코딩) */
             
		     , NULL                                                           AS SPRT_CNTR_CD        /* 지원센터코드 */
		     , '1'                                                            AS APLY_STS_CD         /* 신청상태코드 (하드코딩) */
		     , CASE WHEN LENGTH(REGEXP_REPLACE(A.BIZR_NO, '-', '')) = 10 THEN REGEXP_REPLACE(A.BIZR_NO, '-', '')
		            ELSE NULL END                                             AS BRNO                /* 사업자등록번호 (10자리가 아닌것도 있음) */
		     , A.BSNM_NM                                                      AS ENT_NM              /* 기업명 */
		     , NULL                                                           AS CRNO                /* 법인등록번호 */
		     , CASE WHEN A.BIZR_NO IS NULL OR LENGTH(REGEXP_REPLACE(A.BIZR_NO, '-', '')) != 10 THEN '9'
		            WHEN SUBSTR(REGEXP_REPLACE(A.BIZR_NO, '-', ''), 4, 2) IN ('81', '82', '83', '84', '85', '86', '87', '88') THEN '1'
		            ELSE '2' END                                              AS BZMN_TYPE_CD        /* 사업자유형코드 (1: 법인기업, 2: 개인기업, 9: 알수없음) */
		     , REGEXP_REPLACE(A.BSNM_ZIP, '[^[:digit:]]')                     AS ENT_ZIP             /* 기업우편번호 */
		     , A.BSNM_ADRES                                                   AS ENT_ADDR            /* 기업기본주소 */
		     , A.BSNM_DETAIL_ADRES                                            AS ENT_DADDR           /* 기업상세주소 */
		     , CASE WHEN LENGTH(REGEXP_REPLACE(A.FNTN_DT, '[^[:digit:]]')) = 8 THEN REGEXP_REPLACE(A.FNTN_DT, '[^[:digit:]]')
		            ELSE NULL END                                             AS FNDN_YMD            /* 설립일자 (-포함, 8자리가 아닌 데이터 존재) */
		     , NULL                                                           AS SLS_AMT             /* 매출액 */
		     , NULL                                                           AS FT_WRKR_CNT         /* 상시근로자수 */
		     , REGEXP_REPLACE(A.CLOSED_DT, '-', '')                           AS CLSBIZ_YMD          /* 폐업일자 (-만포함) */
		     , A.INDUTY_SE_CODE                                               AS KSIC_SRCH_CD        /* 표준산업분류 검색용 코드 (업종코드 또는 표준산업분류코드) (4자리만존재) */
		     , NULL                                                           AS ENT_TELNO           /* 기업전화번호 */
		     , D.DISCRHASH                                                    AS DI_VAL              /* DI값 */
		     , crypto_semas.DEC(D.MEMNM,'F@42')                               AS APLCNT_NM           /* 신청자명 (복호화) */
		     , NULL                                                           AS GIVE_AMT            /* 지급금액 (없음) */
		     , crypto_semas.DEC(D.EMAIL,'F@42')                               AS APLCNT_EML          /* 신청자이메일 (복호화) */
		     , crypto_semas.DEC(D.PHONE,'F@42')                               AS APLCNT_TELNO        /* 신청자전화번호 (복호화) */
		     , crypto_semas.DEC(D.MOBILE,'F@42')                              AS APLCNT_MBNO         /* 신청자핸드폰 (복호화) */
		     , REGEXP_REPLACE(D.ZIPCODE, '[^[:digit:]]')                      AS APLCNT_ZIP          /* 신청자우편번호 */
		     , crypto_semas.DEC(D.ADDR1,'F@42')                               AS APLCNT_ADDR         /* 신청자기본주소 (복호화) */
		     , crypto_semas.DEC(D.ADDR2,'F@42')                               AS APLCNT_DADDR        /* 신청자상세주소 (복호화) */
		     , REGEXP_REPLACE(crypto_semas.DEC(D.BIRTHDATE,'F@42'),'-','')    AS APLCNT_BRDT         /* 신청자생년월일 (복호화) */
		     , CASE WHEN D.GENDER = 'M' THEN '1'
		            WHEN D.GENDER = 'F' THEN '2'
		            ELSE '9' END                                              AS APLCNT_GNDR_CD      /* 신청자성별코드 */
		     , NULL                                                           AS CI_VAL              /* CI값 */
		     , crypto_semas.DEC(D.LOGINID,	'F@42')                           AS SRC_LGN_ID          /* 출처시스템로그인ID (복호화) */
		     , TO_CHAR(A.REQST_DT, 'YYYYMMDD')                                AS APLY_YMD            /* 신청일자 */
		     , NULL                                                           AS GIVE_YMD            /* 지급일자 (없음) */
		     , NULL                                                           AS CEO_NM              /* 대표자명 */
		     , REGEXP_REPLACE(A.COMPL_DT, '-', '')                            AS FNSH_YMD            /* 수료일자 */
		     , A.REG_DT                                                       AS SRC_REG_DT          /* 출처시스템등록일시 */
		     , REGEXP_REPLACE(A.COMPL_DT, '-', '')                            AS SLCTN_YMD           /* 선정일자 (수료일자) */
		     
		     /* 교육시스템 */
		     , C.BSNS_NO                                                      AS EDU_SPRT_BIZNO      /* 교육지원사업번호 */
		     , A.PROGRM_SN                                                    AS PRGRM_SN            /* 프로그램순번 */
		     , A.USERNO                                                       AS MBER_SN             /* 회원순번 */
		  FROM EDUMNG.SPT_PROGRM_MBER A  /* 프로그램 수강생 */
		       INNER JOIN EDUMNG.SPT_TASK_PROGRM B  /* 과제프로그램 */
		          ON A.PROGRM_SN = B.PROGRM_SN
		       INNER JOIN EDUMNG.SPT_BSNS_MASTR C  /* 사업기본 */
		          ON B.BSNS_NO = C.BSNS_NO
		       INNER JOIN SEDA.MEM_PUB_INFO_HIS D
		          ON A.USER_HIS = D.MEMHIS
		 WHERE REQST_CODE = 'C'  /* 승인코드 */
		   AND COMPL_AT = 'Y'  /* 수료여부 */
		   AND B.BSNS_NO NOT IN (2, 5, 6, 7)  /* 재기교육, 힐링캠프,전문기술교육, 튼튼창업 제외 */
		   AND A.COMPL_DT BETWEEN TO_CHAR(#{param.startDt}, 'YYYY-MM-DD') AND TO_CHAR(#{param.endDt}, 'YYYY-MM-DD')  /* 배치쿼리일자 */
	</select>
	
	<!-- 오프라인 -->
	<select id="selectList_3" resultMap="FromEduInfo" fetchSize="1000">
		/* SQL ID : FromEduMapper.selectList_3 */
		SELECT C.BSNS_NM                                                      AS SPRT_BIZ_NM         /* 지원사업명 */
		     , B.PBLANC_YEAR                                                  AS SPRT_BIZ_YR         /* 지원사업연도 */
		     , '01'                                                           AS SRC_SYS_CD          /* 출처시스템코드 (하드코딩) */
		     , '01'                                                           AS SPRT_BIZ_DIV_CD     /* 지원사업구분코드 (하드코딩) */
             
		     , NULL                                                           AS SPRT_CNTR_CD        /* 지원센터코드 */
		     , '1'                                                            AS APLY_STS_CD         /* 신청상태코드 (하드코딩) */
		     , CASE WHEN LENGTH(REGEXP_REPLACE(A.BIZR_NO, '-', '')) = 10 THEN REGEXP_REPLACE(A.BIZR_NO, '-', '')
		            ELSE NULL END                                             AS BRNO                /* 사업자등록번호 (10자리가 아닌것도 있음) */
		     , A.BSNM_NM                                                      AS ENT_NM              /* 기업명 */
		     , NULL                                                           AS CRNO                /* 법인등록번호 */
		     , CASE WHEN A.BIZR_NO IS NULL OR LENGTH(REGEXP_REPLACE(A.BIZR_NO, '-', '')) != 10 THEN '9'
		            WHEN SUBSTR(REGEXP_REPLACE(A.BIZR_NO, '-', ''), 4, 2) IN ('81', '82', '83', '84', '85', '86', '87', '88') THEN '1'
		            ELSE '2' END                                              AS BZMN_TYPE_CD        /* 사업자유형코드 (1: 법인기업, 2: 개인기업, 9: 알수없음) */
		     , REGEXP_REPLACE(A.BSNM_ZIP, '[^[:digit:]]')                     AS ENT_ZIP             /* 기업우편번호 */
		     , A.BSNM_ADRES                                                   AS ENT_ADDR            /* 기업기본주소 */
		     , A.BSNM_DETAIL_ADRES                                            AS ENT_DADDR           /* 기업상세주소 */
		     , CASE WHEN LENGTH(REGEXP_REPLACE(A.FNTN_DT, '[^[:digit:]]')) = 8 THEN REGEXP_REPLACE(A.FNTN_DT, '[^[:digit:]]')
		            ELSE NULL END                                             AS FNDN_YMD            /* 설립일자 (-포함, 8자리가 아닌 데이터 존재) */
		     , NULL                                                           AS SLS_AMT             /* 매출액 */
		     , NULL                                                           AS FT_WRKR_CNT         /* 상시근로자수 */
		     , REGEXP_REPLACE(A.CLOSED_DT, '-', '')                           AS CLSBIZ_YMD          /* 폐업일자 (-만포함) */
		     , A.INDUTY_SE_CODE                                               AS KSIC_SRCH_CD        /* 표준산업분류 검색용 코드 (업종코드 또는 표준산업분류코드) (4자리만존재) */
		     , NULL                                                           AS ENT_TELNO           /* 기업전화번호 */
		     , NULL                                                           AS DI_VAL              /* DI값 */
		     , crypto_semas.DEC(D.MEMNM,'F@42')                               AS APLCNT_NM           /* 신청자명 (복호화) */
		     , NULL                                                           AS GIVE_AMT            /* 지급금액 */
		     , crypto_semas.DEC(D.EMAIL,'F@42')                               AS APLCNT_EML          /* 신청자이메일 (복호화) */
		     , crypto_semas.DEC(D.PHONE,'F@42')                               AS APLCNT_TELNO        /* 신청자전화번호 (복호화) */
		     , crypto_semas.DEC(D.MOBILE,'F@42')                              AS APLCNT_MBNO         /* 신청자핸드폰 (복호화) */
		     , REGEXP_REPLACE(D.ZIPCODE, '[^[:digit:]]')                      AS APLCNT_ZIP          /* 신청자우편번호 */
		     , crypto_semas.DEC(D.ADDR1,'F@42')                               AS APLCNT_ADDR         /* 신청자기본주소 (복호화) */
		     , crypto_semas.DEC(D.ADDR2,'F@42')                               AS APLCNT_DADDR        /* 신청자상세주소 (복호화) */
		     , CASE WHEN LENGTH(REGEXP_REPLACE(crypto_semas.DEC(D.BIRTHDATE,'F@42'), '-', '')) = 8
		            THEN REGEXP_REPLACE(crypto_semas.DEC(D.BIRTHDATE,'F@42'), '-', '')
		            ELSE NULL END                                             AS APLCNT_BRDT         /* 신청자생년월일 (복호화) (-포함, 위배있음) */
		     , CASE WHEN UPPER(D.GENDER) = 'M' THEN '1'
		            WHEN UPPER(D.GENDER) = 'F' THEN '2'
		            ELSE '9' END                                              AS APLCNT_GNDR_CD      /* 신청자성별코드 (소문자있음) */
		     , NULL                                                           AS CI_VAL              /* CI값 */
		     , NULL                                                           AS SRC_LGN_ID          /* 출처시스템로그인ID */
		     , TO_CHAR(A.REQST_DT, 'YYYYMMDD')                                AS APLY_YMD            /* 신청일자 */
		     , NULL                                                           AS GIVE_YMD            /* 지급일자 */
		     , NULL                                                           AS CEO_NM              /* 대표자명 */
		     , REGEXP_REPLACE(A.COMPL_DT, '-', '')                            AS FNSH_YMD            /* 수료일자 (넣을지말지 고려) */
		     , A.REG_DT                                                       AS SRC_REG_DT          /* 출처시스템등록일시 */
		     , REGEXP_REPLACE(A.COMPL_DT, '-', '')                            AS SLCTN_YMD           /* 선정일자 (수료일자) */
		     
		     /* 교육시스템 */
		     , C.BSNS_NO                                                      AS EDU_SPRT_BIZNO      /* 교육지원사업번호 */
		     , A.PROGRM_SN                                                    AS PRGRM_SN            /* 프로그램순번 */
		     , A.USERNO                                                       AS MBER_SN             /* 회원순번 */
		  FROM EDUMNG.SPT_PROGRM_MBER A  /* 프로그램 수강생 */
		       INNER JOIN EDUMNG.SPT_TASK_PROGRM B  /* 과제프로그램 */
		          ON A.PROGRM_SN = B.PROGRM_SN
		       INNER JOIN EDUMNG.SPT_BSNS_MASTR C  /* 사업기본 */
		          ON B.BSNS_NO = C.BSNS_NO
		       INNER JOIN EDUMNG.SPT_PUB_INFO D  /* 현장사용자 */
		          ON A.USERNO = D.MEMID
		         AND A.PROGRM_SN = D.PROGRM_SN
		 WHERE REQST_CODE = 'C'  /* 승인코드 */
		   AND COMPL_AT = 'Y'  /* 수료여부 */
		   AND B.BSNS_NO NOT IN (2, 5, 6, 7)  /* 재기교육, 힐링캠프,전문기술교육, 튼튼창업 제외 */
		   AND A.COMPL_DT BETWEEN TO_CHAR(#{param.startDt}, 'YYYY-MM-DD') AND TO_CHAR(#{param.endDt}, 'YYYY-MM-DD')  /* 배치쿼리일자 */
	</select>
	
</mapper>
