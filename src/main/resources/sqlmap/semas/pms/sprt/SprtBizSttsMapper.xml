<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 지원사업현황 화면 -->
<mapper namespace="kr.bizdata.semas.pms.sprt.mapper.SprtBizSttsMapper">
	
	<!-- 전체 사업연도 목록 조회 -->
	<select id="selectYearList" resultType="String">
		/* SQL ID : SprtBizSttsMapper.selectYearList */
		SELECT DATE_FORMAT(NOW(), '%Y') AS SPRT_BIZ_YR
		UNION
		SELECT DISTINCT A.SPRT_BIZ_YR
		  FROM SPRT_BIZ A
		<where>
		<if test="brno != null and brno.length() > 0">
		   AND EXISTS (
		           SELECT 1
		             FROM SPRT_BIZ_APLY B
		            WHERE B.APLY_STS_CD = '1'  /* 신청상태코드 (1: 승인) */
		              AND B.BRNO = #{brno}
		              AND B.SPRT_BIZ_SN = A.SPRT_BIZ_SN
		       )
		</if>
		</where>
		 ORDER BY SPRT_BIZ_YR DESC
	</select>
	
	<!-- 지원사업현황 상세 조회 -->
	<select id="select" resultType="java.util.LinkedHashMap">
		/* SQL ID : SprtBizSttsMapper.select */
		SELECT A.APLY_SN                              AS APLY_SN         /* 신청일련번호 */
		     , A.SPRT_BIZ_SN                          AS SPRT_BIZ_SN     /* 지원사업일련번호 */
		     , D1.CMN_CD_NM                           AS SRC_SYS_NM      /* 출처시스템명 (사업명) */
		     , B.SPRT_BIZ_NM                          AS SPRT_BIZ_NM     /* 지원사업명 (세부사업명) */
		     , TRUNCATE(A.GIVE_AMT / 1000, 0)         AS GIVE_AMT        /* 지급금액 (천원) */
		     , DATE_FORMAT(A.SLCTN_YMD, '%Y-%m-%d')   AS SLCTN_YMD       /* 선정일자 (검색일자) */
		     , A.SPRT_CNTR_CD                         AS SPRT_CNTR_CD    /* 지원센터코드 */
		     , C.DEPT_NM                              AS SPRT_CNTR_NM    /* 지원센터명 */
		     
		     , IFNULL(A.APLCNT_NM, '알수없음')           AS APLCNT_NM       /* 신청자명 */
		     , A.APLCNT_EML                           AS APLCNT_EML      /* 신청자이메일 */
		     , cast(aes_decrypt(unhex(A.APLCNT_MBNO), SHA2('F@42',512))as char) AS APLCNT_MBNO  /* 신청자핸드폰 (복호화) */
		     , A.APLCNT_TELNO                         AS APLCNT_TELNO    /* 신청자전화번호 */
		     , A.APLCNT_ZIP                           AS APLCNT_ZIP      /* 신청자우편번호 */
		     , A.APLCNT_ADDR                          AS APLCNT_ADDR     /* 신청자기본주소 */
		     , A.APLCNT_DADDR                         AS APLCNT_DADDR    /* 신청자상세주소 */
		     , DATE_FORMAT(A.APLCNT_BRDT, '%Y-%m-%d') AS APLCNT_BRDT     /* 신청자생년월일 */
		     , D3.CMN_CD_NM                           AS APLCNT_GNDR_NM  /* 신청자성별명 */
		     , CONCAT(
		           SUBSTR(A.BRNO, 1, 3), '-', SUBSTR(A.BRNO, 4, 2), '-', SUBSTR(A.BRNO, 6, 5)
		       )                                      AS BRNO            /* 사업자등록번호 */
		     , IFNULL(A.ENT_NM, IF(A.BRNO IS NULL, NULL, '알수없음')) AS ENT_NM  /* 기업명 */
		     , CONCAT(
		           SUBSTR(A.CRNO, 1, 6), '-', SUBSTR(A.CRNO, 7, 7)
		       )                                      AS CRNO            /* 법인등록번호 */
		     , D2.CMN_CD_NM                           AS BZMN_TYPE_NM    /* 사업자유형명 */
		     , A.ENT_ZIP                              AS ENT_ZIP         /* 기업우편번호 */
		     , A.CEO_NM                               AS CEO_NM          /* 대표자명 */
		     , A.ENT_ADDR                             AS ENT_ADDR        /* 기업기본주소 */
		     , A.KSIC_CD                              AS KSIC_CD         /* 표준산업분류코드 */
		     , A.ENT_DADDR                            AS ENT_DADDR       /* 기업상세주소 */
		     , DATE_FORMAT(A.FNDN_YMD, '%Y-%m-%d')    AS FNDN_YMD        /* 설립일자 */
		     , A.ENT_TELNO                            AS ENT_TELNO       /* 기업전화번호 */
		  FROM SPRT_BIZ_APLY A
		       INNER JOIN SPRT_BIZ B ON B.SPRT_BIZ_SN = A.SPRT_BIZ_SN  /* 지원사업일련번호 */
		       LEFT OUTER JOIN SEDA_DEPT C ON C.DEPT_CD = A.SPRT_CNTR_CD  /* 지원센터코드 */
		       LEFT OUTER JOIN CMN_CD D1 ON D1.CMN_DIV_CD = 'SRC_SYS_CD'   AND D1.CMN_CD = B.SRC_SYS_CD  /* 출처시스템코드 */
		       LEFT OUTER JOIN CMN_CD D2 ON D2.CMN_DIV_CD = 'BZMN_TYPE_CD' AND D2.CMN_CD = A.BZMN_TYPE_CD  /* 사업자유형코드 */
		       LEFT OUTER JOIN CMN_CD D3 ON D3.CMN_DIV_CD = 'GNDR_CD'      AND D3.CMN_CD = A.APLCNT_GNDR_CD  /* 신청자성별코드 */
		 WHERE A.APLY_STS_CD = '1'  /* 신청상태코드 (1: 승인) */
		   AND A.APLY_SN = #{aplySn}  /* 신청일련번호 */
	</select>
	
	<!-- 지원사업현황 목록 조회 (전체) -->
	<select id="selectListAll" resultType="java.util.HashMap" fetchSize="1000">
		<include refid="sql_selectList_bind" />
		
		/* SQL ID : SprtBizSttsMapper.selectListAll */
		SELECT A.APLY_SN                              AS APLY_SN         /* 신청일련번호 */
		     , D1.CMN_CD_NM                           AS SRC_SYS_NM      /* 출처시스템명 (사업명) */
		     , B.SPRT_BIZ_NM                          AS SPRT_BIZ_NM     /* 지원사업명 (세부사업명) */
		     , B.SPRT_BIZ_YR                          AS SPRT_BIZ_YR     /* 지원사업연도 */
		     , D2.CMN_CD_NM                           AS BZMN_TYPE_NM    /* 사업자유형명 */
		     , IFNULL(A.ENT_NM, IF(A.BRNO IS NULL, NULL, '알수없음')) AS ENT_NM  /* 기업명 */
		     , CONCAT(
		           SUBSTR(A.BRNO, 1, 3), '-', SUBSTR(A.BRNO, 4, 2), '-', SUBSTR(A.BRNO, 6, 5)
		       )                                      AS BRNO            /* 사업자등록번호 */
		     , IFNULL(A.APLCNT_NM, '알수없음')           AS APLCNT_NM       /* 신청자명 */
		     , DATE_FORMAT(A.FNDN_YMD, '%Y-%m-%d')    AS FNDN_YMD        /* 설립일자 */
		     , TRUNCATE(A.GIVE_AMT / 1000, 0)         AS GIVE_AMT        /* 지급금액 (천원) */
		     , C.DEPT_NM                              AS SPRT_CNTR_NM    /* 지원센터명 */
		     , DATE_FORMAT(A.SLCTN_YMD, '%Y-%m-%d')   AS SLCTN_YMD       /* 선정일자 */
		  FROM SPRT_BIZ_APLY A
		       INNER JOIN SPRT_BIZ B ON B.SPRT_BIZ_SN = A.SPRT_BIZ_SN  /* 지원사업일련번호 */
		       LEFT OUTER JOIN SEDA_DEPT C ON C.DEPT_CD = A.SPRT_CNTR_CD  /* 지원센터코드 */
		       LEFT OUTER JOIN CMN_CD D1 ON D1.CMN_DIV_CD = 'SRC_SYS_CD'   AND D1.CMN_CD = B.SRC_SYS_CD  /* 출처시스템코드 */
		       LEFT OUTER JOIN CMN_CD D2 ON D2.CMN_DIV_CD = 'BZMN_TYPE_CD' AND D2.CMN_CD = A.BZMN_TYPE_CD  /* 사업자유형코드 */
		<include refid="sql_selectList_where" />
		 ORDER BY ${orderBy}
	</select>
	
	<!-- 지원사업현황 목록 조회 (페이징) -->
	<select id="selectListPaging" resultType="java.util.LinkedHashMap">
		<include refid="sql_selectList_bind" />
		
		/* SQL ID : SprtBizSttsMapper.selectListPaging */
		SELECT A.APLY_SN                              AS APLY_SN         /* 신청일련번호 */
		     , D1.CMN_CD_NM                           AS SRC_SYS_NM      /* 출처시스템명 (사업명) */
		     , A.SPRT_BIZ_NM                          AS SPRT_BIZ_NM     /* 지원사업명 (세부사업명) */
		     , A.SPRT_BIZ_YR                          AS SPRT_BIZ_YR     /* 지원사업연도 */
		     , D2.CMN_CD_NM                           AS BZMN_TYPE_NM    /* 사업자유형명 */
		     , IFNULL(A.ENT_NM, IF(A.BRNO IS NULL, NULL, '알수없음')) AS ENT_NM  /* 기업명 */
		     , CONCAT(
		           SUBSTR(A.BRNO, 1, 3), '-', SUBSTR(A.BRNO, 4, 2), '-', SUBSTR(A.BRNO, 6, 5)
		       )                                      AS BRNO            /* 사업자등록번호 */
		     , IFNULL(A.APLCNT_NM, '알수없음')           AS APLCNT_NM       /* 신청자명 */
		     , DATE_FORMAT(A.FNDN_YMD, '%Y-%m-%d')    AS FNDN_YMD        /* 설립일자 */
		     , TRUNCATE(A.GIVE_AMT / 1000, 0)         AS GIVE_AMT        /* 지급금액 (천원) */
		     , A.SPRT_CNTR_NM                         AS SPRT_CNTR_NM    /* 지원센터명 */
		     , DATE_FORMAT(A.SLCTN_YMD, '%Y-%m-%d')   AS SLCTN_YMD       /* 선정일자 */
		  FROM (
		           SELECT A.APLY_SN
		                , B.SRC_SYS_CD
		                , B.SPRT_BIZ_NM
		                , B.SPRT_BIZ_YR
		                , A.BZMN_TYPE_CD
		                , A.ENT_NM
		                , A.BRNO
		                , A.APLCNT_NM
		                , A.FNDN_YMD
		                , A.GIVE_AMT
		                , C.DEPT_NM AS SPRT_CNTR_NM
		                , A.SLCTN_YMD
		           <if test="paging.sortName == 'SRC_SYS_NM'">
		                , D1.CMN_CD_NM AS SRC_SYS_NM  /* 출처시스템명 (사업명) - 소팅용 */
		           </if>
		             FROM SPRT_BIZ_APLY A
		                  INNER JOIN SPRT_BIZ B ON B.SPRT_BIZ_SN = A.SPRT_BIZ_SN  /* 지원사업일련번호 */
		                  LEFT OUTER JOIN SEDA_DEPT C ON C.DEPT_CD = A.SPRT_CNTR_CD  /* 지원센터코드 */
		           <if test="paging.sortName == 'SRC_SYS_NM'">
		                  LEFT OUTER JOIN CMN_CD D1 ON D1.CMN_DIV_CD = 'SRC_SYS_CD' AND D1.CMN_CD = B.SRC_SYS_CD  /* 출처시스템코드 */
		           </if>
		           <include refid="sql_selectList_where" />
		            ORDER BY ${orderBy} LIMIT #{paging.startIndex}, #{paging.rowsCnt}
		       ) A
		       LEFT OUTER JOIN CMN_CD D1 ON D1.CMN_DIV_CD = 'SRC_SYS_CD'   AND D1.CMN_CD = A.SRC_SYS_CD  /* 출처시스템코드 */
		       LEFT OUTER JOIN CMN_CD D2 ON D2.CMN_DIV_CD = 'BZMN_TYPE_CD' AND D2.CMN_CD = A.BZMN_TYPE_CD  /* 사업자유형코드 */
	</select>
	
	<sql id="sql_selectList_bind">
		<choose>
			<when test="paging.sortName == 'SRC_SYS_NM'  "><bind name="orderBy" value="'SRC_SYS_NM '   + paging.sortType" /></when>
			<when test="paging.sortName == 'SPRT_BIZ_NM' "><bind name="orderBy" value="'SPRT_BIZ_NM '  + paging.sortType" /></when>
			<when test="paging.sortName == 'SPRT_BIZ_YR' "><bind name="orderBy" value="'SPRT_BIZ_YR '  + paging.sortType" /></when>
			<when test="paging.sortName == 'BZMN_TYPE_NM'"><bind name="orderBy" value="'BZMN_TYPE_CD ' + paging.sortType" /></when>
			<when test="paging.sortName == 'ENT_NM'      "><bind name="orderBy" value="'ENT_NM '       + paging.sortType" /></when>
			<when test="paging.sortName == 'BRNO'        "><bind name="orderBy" value="'BRNO '         + paging.sortType" /></when>
			<when test="paging.sortName == 'APLCNT_NM'   "><bind name="orderBy" value="'APLCNT_NM '    + paging.sortType" /></when>
			<when test="paging.sortName == 'FNDN_YMD'    "><bind name="orderBy" value="'FNDN_YMD '     + paging.sortType" /></when>
			<when test="paging.sortName == 'GIVE_AMT'    "><bind name="orderBy" value="'GIVE_AMT '     + paging.sortType" /></when>
			<when test="paging.sortName == 'SPRT_CNTR_NM'"><bind name="orderBy" value="'SPRT_CNTR_NM ' + paging.sortType" /></when>
			<when test="paging.sortName == 'SLCTN_YMD'   "><bind name="orderBy" value="'SLCTN_YMD '    + paging.sortType" /></when>
			<otherwise><bind name="orderBy" value="'A.APLY_SN DESC'" /></otherwise>
		</choose>
	</sql>
	
	<sql id="sql_selectList_where">
		 WHERE A.APLY_STS_CD = '1'  /* 신청상태코드 (1: 승인) */
		<if test="param.SRC_SYS_CD != null and param.SRC_SYS_CD.length() > 0">
		   AND B.SRC_SYS_CD = #{param.SRC_SYS_CD}
		</if>
		<if test="param.SPRT_BIZ_SN != null and param.SPRT_BIZ_SN.length() > 0">
		   AND B.SPRT_BIZ_SN = #{param.SPRT_BIZ_SN}
		</if>
		<if test="param.SPRT_BIZ_YR != null and param.SPRT_BIZ_YR.length() > 0">
		   AND B.SPRT_BIZ_YR = #{param.SPRT_BIZ_YR}
		</if>
		<if test="param.BRNO != null and param.BRNO.length() > 0"><if test="param.BRNO.length() == 10">
		   AND A.BRNO = #{param.BRNO}
		</if><if test="param.BRNO.length() != 10">
		   AND A.BRNO LIKE CONCAT('%', #{param.BRNO}, '%')
		</if></if>
		<if test="param.ENT_NM != null and param.ENT_NM.length() > 0">
		   AND A.ENT_NM LIKE CONCAT('%', #{param.ENT_NM}, '%')
		</if>
		<if test="param.APLCNT_NM != null and param.APLCNT_NM.length() > 0">
		   AND A.APLCNT_NM LIKE CONCAT('%', #{param.APLCNT_NM}, '%')
		</if>
		<if test="param.SPRT_CNTR_CD != null and param.SPRT_CNTR_CD.length() > 0">
		   AND A.SPRT_CNTR_CD = #{param.SPRT_CNTR_CD}
		</if>
		<if test="param.srchStartYmd != null and param.srchStartYmd.length() > 0">
		   AND A.SLCTN_YMD <![CDATA[ >= ]]> #{param.srchStartYmd}
		</if>
		<if test="param.srchEndYmd != null and param.srchEndYmd.length() > 0">
		   AND A.SLCTN_YMD <![CDATA[ <= ]]> #{param.srchEndYmd}
		</if>
	</sql>
	
	<select id="countList" resultType="int">
		/* SQL ID : SprtBizSttsMapper.countList */
		SELECT COUNT(*)
		  FROM SPRT_BIZ_APLY A
			<if test="(param.SRC_SYS_CD != null and param.SRC_SYS_CD.length() > 0) or (param.SPRT_BIZ_SN != null and param.SPRT_BIZ_SN.length() > 0) or (param.SPRT_BIZ_YR != null and param.SPRT_BIZ_YR.length() > 0)">
		       INNER JOIN SPRT_BIZ B ON A.SPRT_BIZ_SN = B.SPRT_BIZ_SN  /* 지원사업일련번호 */
			</if>
		<include refid="sql_selectList_where" />
	</select>
	
	<!-- 지원사업현황 목록 조회 (페이징, 개인용) -->
	<select id="selectListForPsnlPaging" resultType="java.util.LinkedHashMap">
		<include refid="sql_selectList_bind" />
		
		/* SQL ID : SprtBizSttsMapper.selectListForPsnlPaging */
		SELECT A.APLY_SN                              AS APLY_SN         /* 신청일련번호 */
		     , D1.CMN_CD_NM                           AS SRC_SYS_NM      /* 출처시스템명 (사업명) */
		     , B.SPRT_BIZ_NM                          AS SPRT_BIZ_NM     /* 지원사업명 (세부사업명) */
		     , B.SPRT_BIZ_YR                          AS SPRT_BIZ_YR     /* 지원사업연도 */
		     , D2.CMN_CD_NM                           AS BZMN_TYPE_NM    /* 사업자유형명 */
		     , IFNULL(A.ENT_NM, IF(A.BRNO IS NULL, NULL, '알수없음')) AS ENT_NM  /* 기업명 */
		     , CONCAT(
		           SUBSTR(A.BRNO, 1, 3), '-', SUBSTR(A.BRNO, 4, 2), '-', SUBSTR(A.BRNO, 6, 5)
		       )                                      AS BRNO            /* 사업자등록번호 */
		     , IFNULL(A.APLCNT_NM, '알수없음')           AS APLCNT_NM       /* 신청자명 */
		     , DATE_FORMAT(A.FNDN_YMD, '%Y-%m-%d')    AS FNDN_YMD        /* 설립일자 */
		     , TRUNCATE(A.GIVE_AMT / 1000, 0)         AS GIVE_AMT        /* 지급금액 (천원) */
		     , C.DEPT_NM                              AS SPRT_CNTR_NM    /* 지원센터명 */
		     , DATE_FORMAT(A.SLCTN_YMD, '%Y-%m-%d')   AS SLCTN_YMD       /* 선정일자 */
		  FROM SPRT_BIZ_APLY A
		       INNER JOIN SPRT_BIZ B ON B.SPRT_BIZ_SN = A.SPRT_BIZ_SN  /* 지원사업일련번호 */
		       LEFT OUTER JOIN SEDA_DEPT C ON C.DEPT_CD = A.SPRT_CNTR_CD  /* 지원센터코드 */
		       LEFT OUTER JOIN CMN_CD D1 ON D1.CMN_DIV_CD = 'SRC_SYS_CD'   AND D1.CMN_CD = B.SRC_SYS_CD  /* 출처시스템코드 */
		       LEFT OUTER JOIN CMN_CD D2 ON D2.CMN_DIV_CD = 'BZMN_TYPE_CD' AND D2.CMN_CD = A.BZMN_TYPE_CD  /* 사업자유형코드 */
		<include refid="sql_selectListForPsnl_where" />
		 ORDER BY ${orderBy} LIMIT #{paging.startIndex}, #{paging.rowsCnt}
	</select>
	
	<sql id="sql_selectListForPsnl_where">
		 WHERE A.APLY_STS_CD = '1'  /* 신청상태코드 (1: 승인) */
		<choose>
		<when test="param.DI_VAL != null and param.DI_VAL.length() > 0">
		   AND A.DI_VAL = #{param.DI_VAL}
		</when>
		<when test="param.PSNL_SN > 0">
		   AND EXISTS (
		           SELECT 1
		             FROM BNFT_PSNL_TEMP T
		            WHERE T.PSNL_SN = #{param.PSNL_SN}
		              AND T.APLY_SN = A.APLY_SN
		       )
		</when>
		<otherwise>
		   AND 1 = 0  /* 검색결과 없음 */
		</otherwise>
		</choose>
	</sql>
	
	<select id="countListForPsnl" resultType="int">
		/* SQL ID : SprtBizSttsMapper.countListForPsnl */
		SELECT COUNT(*)
		  FROM SPRT_BIZ_APLY A
		<include refid="sql_selectListForPsnl_where" />
	</select>
	
	<!-- 세부사업 검색 (페이징) -->
	<select id="selectSprtBizListPaging" resultType="java.util.LinkedHashMap">
		<choose>
			<when test="paging.sortName == 'SRC_SYS_NM'  "><bind name="orderBy" value="'SRC_SYS_NM '   + paging.sortType" /></when>
			<when test="paging.sortName == 'SPRT_BIZ_NM' "><bind name="orderBy" value="'SPRT_BIZ_NM '  + paging.sortType" /></when>
			<when test="paging.sortName == 'SPRT_BIZ_YR' "><bind name="orderBy" value="'SPRT_BIZ_YR '  + paging.sortType" /></when>
			<otherwise><bind name="orderBy" value="'B.SPRT_BIZ_SN DESC'" /></otherwise>
		</choose>
		
		/* SQL ID : SprtBizSttsMapper.selectSprtBizListPaging */
		SELECT B.SPRT_BIZ_SN               /* 지원사업일련번호 */
		     , D1.CMN_CD_NM AS SRC_SYS_NM  /* 출처시스템명 (사업명) */
		     , B.SPRT_BIZ_NM               /* 지원사업명 (세부사업명) */
		     , B.SPRT_BIZ_YR               /* 지원사업연도 */
		  FROM SPRT_BIZ B
		       LEFT OUTER JOIN CMN_CD D1 ON D1.CMN_DIV_CD = 'SRC_SYS_CD'   AND D1.CMN_CD = B.SRC_SYS_CD    /* 출처시스템코드 */
		<include refid="sql_selectSprtBizList_where" />
		 ORDER BY ${orderBy} LIMIT #{paging.startIndex}, #{paging.rowsCnt}
	</select>
	
	<sql id="sql_selectSprtBizList_where">
		<where>
		<if test="param.SPRT_BIZ_NM != null and param.SPRT_BIZ_NM.length() > 0">
		   AND B.SPRT_BIZ_NM LIKE CONCAT('%', #{param.SPRT_BIZ_NM}, '%')  /* 지원사업명 */
		</if>
		<if test="param.SPRT_BIZ_YR != null and param.SPRT_BIZ_YR.length() > 0">
		   AND B.SPRT_BIZ_YR = #{param.SPRT_BIZ_YR}  /* 지원사업연도 */
		</if>
		<if test="param.SRC_SYS_CD != null and param.SRC_SYS_CD.length() > 0">
		   AND B.SRC_SYS_CD = #{param.SRC_SYS_CD}  /* 출처시스템코드 */
		</if>
		</where>
	</sql>
	
	<select id="countSprtBizList" resultType="int">
		/* SQL ID : SprtBizSttsMapper.countSprtBizList */
		SELECT COUNT(*)
		  FROM SPRT_BIZ B
		<include refid="sql_selectSprtBizList_where" />
	</select>
	
	<!-- 센터 검색 -->
	<select id="selectSprtCntrList" resultType="java.util.LinkedHashMap">
		/* SQL ID : SprtBizSttsMapper.selectSprtCntrList */
		SELECT DEPT_CD     /* 센터코드 */
		     , UP_DEPT_CD  /* 상위 센터코드 */
		     , DEPT_NM     /* 센터명 */
		     , USE_YN      /* 상태 (Y: 운영, N: 정지) */
		  FROM (
				<if test="param.USE_YN == null or param.USE_YN == 'Y'.toString()">
		           /* 본부 (6개) */
		           SELECT A.RGN_CD
		                , A.DEPT_CD
		                , NULL AS UP_DEPT_CD
		                , A.DEPT_NM
		                , A.USE_YN
		             FROM SEDA_DEPT A
		            WHERE A.CNTR_TYPE_CD IN ('10')  /* 센터타입코드 (10: 지역본부) */
		              AND A.USE_YN = 'Y'
		           UNION ALL
		           /* 센터 (85개) */
		           SELECT A.RGN_CD
		                , B.DEPT_CD
		                , B.UP_DEPT_CD
		                , B.DEPT_NM
		                , B.USE_YN
		             FROM SEDA_DEPT A
		                  INNER JOIN SEDA_DEPT B ON B.UP_DEPT_CD = A.DEPT_CD
		            WHERE A.CNTR_TYPE_CD IN ('10')  /* 센터타입코드 (10: 지역본부) */
		              AND A.USE_YN = 'Y'
		              AND B.USE_YN = 'Y'
				</if>
				<if test="param.USE_YN == null">
		           UNION ALL
				</if>
				<if test="param.USE_YN == null or param.USE_YN == 'N'.toString()">
		           /* 폐쇄본부 */
		           SELECT 'ZZZZZZ' AS RGN_CD
		                , 'ZZZZZZ' AS DEPT_CD  /* 폐쇄본부코드 */
		                , NULL AS UP_DEPT_CD
		                , '폐쇄' AS DEPT_NM
		                , 'N' AS USE_YN
		           UNION ALL
		           /* 폐쇄센터 (현재 사용하지 않는 센터, 분소) */
		           SELECT 'ZZZZZZ'
		                , C.DEPT_CD
		                , 'ZZZZZZ'  /* 폐쇄본부코드 */
		                , C.DEPT_NM
		                , C.USE_YN
		             FROM SEDA_DEPT C
		            WHERE C.CNTR_TYPE_CD IN ('20', '30')  /* 센터타입코드 (20: 센터, 30: 분소) */
		              AND C.USE_YN = 'N'
				</if>
		       ) A
		<if test="param.SPRT_CNTR_NM != null and param.SPRT_CNTR_NM.length() > 0">
		 WHERE UP_DEPT_CD IS NULL  /* 본부 */
		    OR DEPT_NM LIKE CONCAT('%', #{param.SPRT_CNTR_NM}, '%')  /* 센터명 */
		</if>
		 ORDER BY USE_YN DESC, UP_DEPT_CD ASC, RGN_CD ASC, DEPT_CD ASC
	</select>
	
</mapper>
